<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titanium PDF Suite - Faizan Ahmad</title>
    
    <!-- External Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        :root {
            --primary: #4338ca;       /* Indigo */
            --accent: #0ea5e9;        /* Sky Blue */
            --bg-dark: #0f172a;       /* Dark Blue/Black */
            --bg-panel: #1e293b;      /* Slate */
            --text-light: #f8fafc;
            --text-gray: #94a3b8;
            --success: #10b981;
            --border: #334155;
        }

        * { box-sizing: border-box; outline: none; }
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden; /* App-like feel */
        }

        /* --- SIDEBAR (SETTINGS) --- */
        .sidebar {
            width: 320px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            z-index: 10;
        }

        .brand {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 30px;
            color: white;
            display: flex; align-items: center; gap: 10px;
        }
        .brand span { color: var(--accent); }

        .section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-gray);
            margin-bottom: 10px;
            margin-top: 20px;
            font-weight: 700;
        }

        .control-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-bottom: 10px;
        }

        .input-field {
            width: 100%;
            background: transparent;
            border: 1px solid var(--border);
            color: white;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            font-size: 13px;
        }
        .input-field:focus { border-color: var(--accent); }

        /* Quality Buttons */
        .quality-group { display: flex; gap: 5px; background: #0f172a; padding: 5px; border-radius: 6px; border: 1px solid var(--border); }
        .q-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-gray);
            padding: 6px;
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: 0.2s;
        }
        .q-btn.active { background: var(--primary); color: white; }

        /* --- MAIN AREA --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Top Bar */
        .top-bar {
            padding: 15px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
        }

        .file-stats { font-size: 13px; color: var(--text-gray); }
        .file-stats b { color: white; }

        .action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: flex; align-items: center; gap: 8px;
            transition: 0.2s;
        }
        .action-btn:hover { background: #4f46e5; }
        .action-btn:disabled { background: var(--border); cursor: not-allowed; }

        /* Upload & Grid Area */
        .workspace {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .upload-hero {
            width: 100%;
            max-width: 600px;
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 30px;
        }
        .upload-hero:hover { border-color: var(--accent); background: rgba(14, 165, 233, 0.05); }
        .upload-hero i { font-size: 40px; color: var(--text-gray); margin-bottom: 10px; }

        .grid-container {
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            padding-bottom: 100px; /* Space for footer */
        }

        .card {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            position: relative;
            cursor: grab;
            transition: 0.2s;
        }
        .card:hover { border-color: var(--accent); transform: translateY(-3px); }
        
        .card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            background: #000;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding: 0 4px;
        }
        .pg-num { font-size: 11px; color: var(--text-gray); font-weight: bold; }
        
        .icon-btn {
            background: transparent; border: none; color: var(--text-gray);
            cursor: pointer; transition: 0.2s; font-size: 14px;
        }
        .icon-btn:hover { color: white; }
        .icon-btn.del:hover { color: #ef4444; }

        /* --- FOOTER & LOG --- */
        .footer-bar {
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }
        
        .console-log {
            font-family: monospace;
            color: var(--text-gray);
        }
        .console-log span { color: var(--accent); }

        /* Requested Copyright Style */
        .copyright-link {
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .copyright-text { color: #008000; font-weight: 500; }
        .copyright-name {
            color: #008000;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 14px;
            margin: 0;
        }

        /* --- MODAL --- */
        .modal-wrap {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            padding: 30px;
            border-radius: 12px;
            width: 400px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        .success-checkmark {
            width: 60px; height: 60px;
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px;
            margin: 0 auto 20px;
        }

        .dl-btn {
            display: block; width: 100%;
            background: var(--success); color: white;
            padding: 12px; border-radius: 6px;
            text-decoration: none; font-weight: bold;
            margin-top: 20px;
        }
        
        .copy-group {
            display: flex; margin-top: 15px;
            background: var(--bg-dark); border-radius: 6px; padding: 4px;
        }
        .copy-input { flex: 1; background: transparent; border: none; color: white; font-size: 12px; padding: 5px; }
        .cp-btn { background: var(--border); color: white; border: none; border-radius: 4px; cursor: pointer; padding: 5px 10px; font-size: 11px; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow-y: auto; height: auto; }
            .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--border); }
            .main-content { height: auto; }
        }

    </style>
</head>
<body>

    <!-- SIDEBAR SETTINGS -->
    <aside class="sidebar">
        <div class="brand"><i class="fas fa-cube"></i> Titanium <span>Suite</span></div>

        <!-- File Settings -->
        <div class="section-title">File Info</div>
        <div class="control-box">
            <input type="text" id="fileName" class="input-field" placeholder="Filename (e.g. Scanned_Docs)" oninput="saveSettings()">
            <select id="pageSize" class="input-field" onchange="saveSettings()">
                <option value="a4">A4 Size</option>
                <option value="letter">Letter Size</option>
                <option value="legal">Legal Size</option>
            </select>
            <select id="orientation" class="input-field" onchange="saveSettings()">
                <option value="p">Portrait (Vertical)</option>
                <option value="l">Landscape (Horizontal)</option>
            </select>
        </div>

        <!-- PDF Metadata (New) -->
        <div class="section-title">PDF Metadata</div>
        <div class="control-box">
            <input type="text" id="metaAuthor" class="input-field" placeholder="Author Name" oninput="saveSettings()">
            <input type="text" id="metaSubject" class="input-field" placeholder="Subject / Title" oninput="saveSettings()">
        </div>

        <!-- Compression (New) -->
        <div class="section-title">Compression</div>
        <div class="quality-group">
            <button class="q-btn" id="qLow" onclick="setQuality(0.3, this)">Low</button>
            <button class="q-btn active" id="qMed" onclick="setQuality(0.6, this)">Med</button>
            <button class="q-btn" id="qHigh" onclick="setQuality(1.0, this)">Max</button>
        </div>

        <div style="margin-top: auto; padding-top: 20px;">
            <button onclick="clearAll()" style="width:100%; padding:10px; background:rgba(239, 68, 68, 0.1); color:#ef4444; border:1px solid #ef4444; border-radius:6px; cursor:pointer;">
                <i class="fas fa-trash"></i> Reset All
            </button>
        </div>
    </aside>

    <!-- MAIN WORKSPACE -->
    <main class="main-content">
        <div class="top-bar">
            <div class="file-stats">
                Images: <b id="countVal">0</b> | Size: <b id="sizeVal">0 MB</b>
            </div>
            <button class="action-btn" id="generateBtn" onclick="generatePDF()" disabled>
                <i class="fas fa-bolt"></i> Generate PDF
            </button>
        </div>

        <div class="workspace">
            <div class="upload-hero" id="dropZone">
                <input type="file" id="fileInput" multiple accept="image/*" style="display:none">
                <i class="fas fa-cloud-arrow-up"></i>
                <h3 style="margin:0; color:white;">Drop Images Here</h3>
                <p style="margin:5px 0 0; font-size:13px; color:var(--text-gray);">or click to browse</p>
            </div>

            <div class="grid-container" id="imageGrid">
                <!-- Cards inject here -->
            </div>
        </div>

        <!-- FOOTER BAR -->
        <footer class="footer-bar">
            <div class="console-log" id="consoleLog">> Ready...</div>
            
            <!-- GREEN LINK SECTION -->
            <a href="https://www.facebook.com" target="_blank" class="copyright-link">
                <span class="copyright-text">Â© 2025</span>
                <h2 class="copyright-name">MUHAMMAD FAIZAN AHMED</h2>
            </a>
        </footer>
    </main>

    <!-- MODAL -->
    <div class="modal-wrap" id="resultModal">
        <div class="modal">
            <div class="success-checkmark"><i class="fas fa-check"></i></div>
            <h2 style="color:white; margin:0;">PDF Generated</h2>
            <p style="color:var(--text-gray); font-size:14px; margin-top:5px;">Your file is ready to export.</p>
            
            <a href="#" id="finalLink" class="dl-btn" download target="_blank">Download PDF</a>
            
            <div class="copy-group">
                <input type="text" id="blobUrl" class="copy-input" readonly value="...">
                <button class="cp-btn" onclick="copyUrl()">COPY</button>
            </div>
            
            <button onclick="closeModal()" style="margin-top:15px; background:none; border:none; color:var(--text-gray); cursor:pointer;">Close</button>
        </div>
    </div>

<script>
    // --- STATE MANAGEMENT ---
    const grid = document.getElementById('imageGrid');
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    let imageStore = {};
    let idCounter = 0;
    let selectedQuality = 0.6; // Default Medium

    // --- INIT ---
    // Load Settings from LocalStorage
    window.onload = function() {
        if(localStorage.getItem('titan_fileName')) document.getElementById('fileName').value = localStorage.getItem('titan_fileName');
        if(localStorage.getItem('titan_author')) document.getElementById('metaAuthor').value = localStorage.getItem('titan_author');
        if(localStorage.getItem('titan_subject')) document.getElementById('metaSubject').value = localStorage.getItem('titan_subject');
        log("System initialized.");
    };

    // Sortable Drag & Drop
    new Sortable(grid, { 
        animation: 150, 
        ghostClass: 'sortable-ghost',
        onEnd: updateCounts
    });

    // --- FUNCTIONS ---

    function saveSettings() {
        localStorage.setItem('titan_fileName', document.getElementById('fileName').value);
        localStorage.setItem('titan_author', document.getElementById('metaAuthor').value);
        localStorage.setItem('titan_subject', document.getElementById('metaSubject').value);
    }

    function setQuality(val, btn) {
        selectedQuality = val;
        document.querySelectorAll('.q-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        log(`Compression set to: ${val === 1 ? 'Max' : val === 0.3 ? 'Low' : 'Medium'}`);
    }

    function log(msg) {
        const consoleEl = document.getElementById('consoleLog');
        const time = new Date().toLocaleTimeString().split(' ')[0];
        consoleEl.innerHTML = `<span>[${time}]</span> > ${msg}`;
    }

    // --- UPLOAD HANDLERS ---
    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = 'var(--accent)'; });
    dropZone.addEventListener('dragleave', () => { dropZone.style.borderColor = 'var(--border)'; });
    dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.style.borderColor = 'var(--border)'; handleFiles(e.dataTransfer.files); });
    fileInput.addEventListener('change', (e) => { handleFiles(e.target.files); fileInput.value = ''; });

    function handleFiles(files) {
        let count = 0;
        Array.from(files).forEach(file => {
            if(!file.type.startsWith('image/')) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                addCard(e.target.result);
            };
            reader.readAsDataURL(file);
            count++;
        });
        if(count > 0) log(`Imported ${count} images.`);
    }

    function addCard(src) {
        idCounter++;
        const id = `img-${idCounter}`;
        imageStore[id] = { src: src, rotation: 0 };

        const div = document.createElement('div');
        div.className = 'card';
        div.setAttribute('data-id', id);
        div.innerHTML = `
            <img src="${src}" id="view-${id}">
            <div class="card-meta">
                <span class="pg-num">PAGE <span class="pg-idx">0</span></span>
                <div>
                    <button class="icon-btn" onclick="rotate('${id}')" title="Rotate"><i class="fas fa-rotate-right"></i></button>
                    <button class="icon-btn del" onclick="remove('${id}')" title="Remove"><i class="fas fa-xmark"></i></button>
                </div>
            </div>
        `;
        grid.appendChild(div);
        updateCounts();
    }

    function rotate(id) {
        const data = imageStore[id];
        data.rotation = (data.rotation + 90) % 360;
        document.getElementById(`view-${id}`).style.transform = `rotate(${data.rotation}deg)`;
    }

    function remove(id) {
        document.querySelector(`[data-id="${id}"]`).remove();
        delete imageStore[id];
        updateCounts();
    }

    function clearAll() {
        if(confirm("Clear workspace?")) {
            grid.innerHTML = '';
            imageStore = {};
            updateCounts();
            log("Workspace cleared.");
        }
    }

    function updateCounts() {
        const cards = grid.querySelectorAll('.card');
        document.getElementById('countVal').innerText = cards.length;
        document.getElementById('generateBtn').disabled = cards.length === 0;
        
        // Update Page Numbers visually
        cards.forEach((card, idx) => {
            card.querySelector('.pg-idx').innerText = idx + 1;
        });

        // Mock Size Calc (Estimating base64 size)
        let total = 0;
        for(let k in imageStore) total += imageStore[k].src.length * 0.75; // Approx bytes
        document.getElementById('sizeVal').innerText = (total / (1024*1024)).toFixed(1) + " MB";
    }

    // --- GENERATION ENGINE ---
    async function generatePDF() {
        const btn = document.getElementById('generateBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        btn.disabled = true;
        log("Starting PDF compilation...");

        try {
            const { jsPDF } = window.jspdf;
            const pageSize = document.getElementById('pageSize').value;
            const orientation = document.getElementById('orientation').value;
            const doc = new jsPDF({ format: pageSize, orientation: orientation, unit: 'mm' });

            // Set Metadata
            doc.setProperties({
                title: document.getElementById('fileName').value || 'Document',
                subject: document.getElementById('metaSubject').value,
                author: document.getElementById('metaAuthor').value,
                creator: 'Titanium PDF Suite'
            });

            const cards = grid.querySelectorAll('.card');
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 10;

            for (let i = 0; i < cards.length; i++) {
                const id = cards[i].getAttribute('data-id');
                const data = imageStore[id];

                // Rotate/Compress via Canvas
                const processedImg = await processImage(data.src, data.rotation, selectedQuality);

                const imgProps = doc.getImageProperties(processedImg);
                const ratio = imgProps.width / imgProps.height;
                
                const availW = pageWidth - (margin * 2);
                const availH = pageHeight - (margin * 2);
                
                let w = availW;
                let h = w / ratio;

                if (h > availH) {
                    h = availH;
                    w = h * ratio;
                }

                if (i > 0) doc.addPage();
                doc.addImage(processedImg, 'JPEG', margin + (availW - w)/2, margin + (availH - h)/2, w, h);
                log(`Processed page ${i+1}/${cards.length}`);
            }

            // Output
            let fname = document.getElementById('fileName').value || 'Titanium-Doc';
            if(!fname.endsWith('.pdf')) fname += '.pdf';

            const blob = doc.output('blob');
            const url = URL.createObjectURL(blob);

            const link = document.getElementById('finalLink');
            link.href = url;
            link.download = fname;
            document.getElementById('blobUrl').value = url;
            
            document.getElementById('resultModal').style.display = 'flex';
            log("PDF generation complete.");

        } catch (err) {
            console.error(err);
            alert("Error generating PDF");
        } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    function processImage(src, rotation, quality) {
        return new Promise(resolve => {
            const img = new Image();
            img.src = src;
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                if (rotation === 90 || rotation === 270) {
                    canvas.width = img.height;
                    canvas.height = img.width;
                } else {
                    canvas.width = img.width;
                    canvas.height = img.height;
                }

                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(rotation * Math.PI / 180);
                ctx.drawImage(img, -img.width / 2, -img.height / 2);
                
                resolve(canvas.toDataURL('image/jpeg', quality));
            };
        });
    }

    function closeModal() { document.getElementById('resultModal').style.display = 'none'; }
    function copyUrl() {
        const copyText = document.getElementById("blobUrl");
        copyText.select();
        navigator.clipboard.writeText(copyText.value);
        log("Link copied to clipboard.");
    }
</script>

</body>
</html>
